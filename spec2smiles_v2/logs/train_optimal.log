============================================================
Training Part A (Spectrum -> Descriptors)
============================================================
Model:   Hybrid CNN-Transformer
Dataset: gnps
Device:  cuda

Loading and preprocessing raw data...
Loaded 23481/23630 valid samples
Calculating 69 descriptors in parallel...
Calculating descriptors (24 workers):   0%|          | 0/23481 [00:00<?, ?it/s]Calculating descriptors (24 workers):   0%|          | 1/23481 [00:04<26:26:50,  4.05s/it]Calculating descriptors (24 workers):   3%|▎         | 601/23481 [00:12<07:15, 52.52it/s] Calculating descriptors (24 workers):  20%|█▉        | 4601/23481 [00:15<00:48, 391.49it/s]Calculating descriptors (24 workers):  30%|██▉       | 7001/23481 [00:17<00:27, 596.17it/s]Calculating descriptors (24 workers):  31%|███       | 7201/23481 [00:18<00:31, 518.80it/s]Calculating descriptors (24 workers):  45%|████▌     | 10601/23481 [00:18<00:11, 1109.59it/s]Calculating descriptors (24 workers):  48%|████▊     | 11384/23481 [00:20<00:13, 881.72it/s] Calculating descriptors (24 workers):  51%|█████     | 11925/23481 [00:21<00:14, 778.28it/s]Calculating descriptors (24 workers):  52%|█████▏    | 12308/23481 [00:23<00:19, 566.58it/s]Calculating descriptors (24 workers):  54%|█████▎    | 12577/23481 [00:24<00:18, 583.24it/s]Calculating descriptors (24 workers):  55%|█████▌    | 13001/23481 [00:25<00:19, 541.87it/s]Calculating descriptors (24 workers):  58%|█████▊    | 13701/23481 [00:25<00:15, 644.50it/s]Calculating descriptors (24 workers):  60%|█████▉    | 14001/23481 [00:26<00:13, 687.80it/s]Calculating descriptors (24 workers):  60%|██████    | 14134/23481 [00:27<00:17, 532.51it/s]Calculating descriptors (24 workers):  63%|██████▎   | 14901/23481 [00:28<00:14, 598.34it/s]Calculating descriptors (24 workers):  64%|██████▍   | 15101/23481 [00:29<00:18, 454.07it/s]Calculating descriptors (24 workers):  65%|██████▍   | 15201/23481 [00:29<00:20, 406.45it/s]Calculating descriptors (24 workers):  66%|██████▋   | 15601/23481 [00:30<00:16, 466.25it/s]Calculating descriptors (24 workers):  69%|██████▉   | 16301/23481 [00:31<00:13, 536.67it/s]Calculating descriptors (24 workers):  71%|███████   | 16701/23481 [00:31<00:10, 677.62it/s]Calculating descriptors (24 workers):  73%|███████▎  | 17201/23481 [00:33<00:16, 390.12it/s]Calculating descriptors (24 workers):  76%|███████▌  | 17901/23481 [00:38<00:24, 230.31it/s]Calculating descriptors (24 workers):  98%|█████████▊| 23101/23481 [00:39<00:00, 1075.44it/s]Calculating descriptors (24 workers): 100%|██████████| 23481/23481 [00:39<00:00, 593.84it/s] 
Processing spectra:   0%|          | 0/23481 [00:00<?, ?it/s]Processing spectra:   1%|          | 190/23481 [00:00<00:12, 1896.66it/s]Processing spectra:   2%|▏         | 380/23481 [00:00<00:22, 1015.85it/s]Processing spectra:   2%|▏         | 504/23481 [00:00<00:22, 1039.42it/s]Processing spectra:   7%|▋         | 1624/23481 [00:00<00:05, 4065.15it/s]Processing spectra:  12%|█▏        | 2711/23481 [00:00<00:03, 6090.19it/s]Processing spectra:  15%|█▍        | 3430/23481 [00:00<00:03, 5602.02it/s]Processing spectra:  17%|█▋        | 4069/23481 [00:01<00:04, 4109.36it/s]Processing spectra:  20%|█▉        | 4582/23481 [00:01<00:09, 1968.19it/s]Processing spectra:  21%|██        | 4957/23481 [00:01<00:09, 1990.78it/s]Processing spectra:  22%|██▏       | 5280/23481 [00:02<00:09, 1921.76it/s]Processing spectra:  24%|██▎       | 5556/23481 [00:02<00:10, 1746.19it/s]Processing spectra:  25%|██▍       | 5787/23481 [00:02<00:10, 1656.45it/s]Processing spectra:  26%|██▌       | 5989/23481 [00:02<00:10, 1599.38it/s]Processing spectra:  26%|██▋       | 6200/23481 [00:02<00:10, 1690.93it/s]Processing spectra:  28%|██▊       | 6476/23481 [00:02<00:08, 1909.38it/s]Processing spectra:  29%|██▉       | 6755/23481 [00:02<00:07, 2102.55it/s]Processing spectra:  30%|██▉       | 6990/23481 [00:03<00:17, 937.40it/s] Processing spectra:  31%|███       | 7284/23481 [00:03<00:13, 1199.40it/s]Processing spectra:  32%|███▏      | 7527/23481 [00:03<00:11, 1393.15it/s]Processing spectra:  33%|███▎      | 7748/23481 [00:03<00:12, 1294.87it/s]Processing spectra:  34%|███▍      | 7935/23481 [00:04<00:18, 847.69it/s] Processing spectra:  34%|███▍      | 8078/23481 [00:04<00:17, 877.88it/s]Processing spectra:  35%|███▌      | 8278/23481 [00:04<00:14, 1051.01it/s]Processing spectra:  36%|███▌      | 8430/23481 [00:04<00:14, 1062.20it/s]Processing spectra:  36%|███▋      | 8569/23481 [00:04<00:15, 977.89it/s] Processing spectra:  37%|███▋      | 8690/23481 [00:05<00:14, 1004.76it/s]Processing spectra:  38%|███▊      | 8888/23481 [00:05<00:12, 1209.98it/s]Processing spectra:  38%|███▊      | 9029/23481 [00:05<00:11, 1243.93it/s]Processing spectra:  39%|███▉      | 9225/23481 [00:05<00:10, 1415.13it/s]Processing spectra:  40%|████      | 9412/23481 [00:05<00:09, 1533.33it/s]Processing spectra:  41%|████▏     | 9704/23481 [00:05<00:07, 1907.80it/s]Processing spectra:  42%|████▏     | 9907/23481 [00:05<00:07, 1829.91it/s]Processing spectra:  43%|████▎     | 10155/23481 [00:05<00:06, 2006.98it/s]Processing spectra:  44%|████▍     | 10364/23481 [00:05<00:06, 1949.52it/s]Processing spectra:  45%|████▌     | 10597/23481 [00:06<00:06, 2053.39it/s]Processing spectra:  46%|████▌     | 10826/23481 [00:06<00:05, 2114.92it/s]Processing spectra:  47%|████▋     | 11042/23481 [00:06<00:06, 2061.16it/s]Processing spectra:  48%|████▊     | 11268/23481 [00:06<00:05, 2113.51it/s]Processing spectra:  49%|████▉     | 11482/23481 [00:06<00:05, 2037.67it/s]Processing spectra:  50%|████▉     | 11695/23481 [00:06<00:05, 2061.09it/s]Processing spectra:  51%|█████     | 11903/23481 [00:06<00:05, 1969.32it/s]Processing spectra:  52%|█████▏    | 12299/23481 [00:06<00:04, 2528.66it/s]Processing spectra:  54%|█████▎    | 12585/23481 [00:06<00:04, 2620.92it/s]Processing spectra:  55%|█████▌    | 12999/23481 [00:06<00:03, 3061.69it/s]Processing spectra:  57%|█████▋    | 13367/23481 [00:07<00:03, 3234.10it/s]Processing spectra:  58%|█████▊    | 13724/23481 [00:07<00:02, 3326.63it/s]Processing spectra:  60%|██████    | 14111/23481 [00:07<00:02, 3475.53it/s]Processing spectra:  62%|██████▏   | 14481/23481 [00:07<00:02, 3540.24it/s]Processing spectra:  63%|██████▎   | 14851/23481 [00:07<00:02, 3586.52it/s]Processing spectra:  66%|██████▌   | 15399/23481 [00:07<00:01, 4143.77it/s]Processing spectra:  69%|██████▊   | 16095/23481 [00:07<00:01, 4982.90it/s]Processing spectra:  71%|███████▏  | 16742/23481 [00:07<00:01, 5410.45it/s]Processing spectra:  74%|███████▎  | 17292/23481 [00:07<00:01, 5435.43it/s]Processing spectra:  76%|███████▋  | 17935/23481 [00:08<00:01, 4009.60it/s]Processing spectra:  78%|███████▊  | 18395/23481 [00:08<00:02, 2222.86it/s]Processing spectra:  80%|███████▉  | 18746/23481 [00:09<00:03, 1225.28it/s]Processing spectra:  81%|████████  | 19006/23481 [00:09<00:05, 892.34it/s] Processing spectra:  82%|████████▏ | 19201/23481 [00:10<00:05, 721.50it/s]Processing spectra:  82%|████████▏ | 19348/23481 [00:10<00:06, 645.81it/s]Processing spectra:  83%|████████▎ | 19464/23481 [00:11<00:06, 583.88it/s]Processing spectra:  83%|████████▎ | 19556/23481 [00:11<00:07, 543.08it/s]Processing spectra:  84%|████████▎ | 19632/23481 [00:11<00:07, 527.87it/s]Processing spectra:  84%|████████▍ | 19699/23481 [00:11<00:07, 534.47it/s]Processing spectra:  84%|████████▍ | 19763/23481 [00:11<00:07, 506.44it/s]Processing spectra:  84%|████████▍ | 19820/23481 [00:11<00:07, 507.88it/s]Processing spectra:  85%|████████▍ | 19876/23481 [00:12<00:07, 503.17it/s]Processing spectra:  85%|████████▍ | 19940/23481 [00:12<00:06, 530.40it/s]Processing spectra:  85%|████████▌ | 19997/23481 [00:12<00:06, 515.55it/s]Processing spectra:  85%|████████▌ | 20061/23481 [00:12<00:06, 544.97it/s]Processing spectra:  86%|████████▌ | 20121/23481 [00:12<00:06, 554.93it/s]Processing spectra:  87%|████████▋ | 20416/23481 [00:12<00:02, 1185.41it/s]Processing spectra:  87%|████████▋ | 20545/23481 [00:12<00:03, 952.85it/s] Processing spectra:  88%|████████▊ | 20655/23481 [00:12<00:03, 880.77it/s]Processing spectra:  88%|████████▊ | 20754/23481 [00:13<00:03, 774.11it/s]Processing spectra:  89%|████████▉ | 20840/23481 [00:13<00:03, 771.36it/s]Processing spectra:  89%|████████▉ | 20923/23481 [00:13<00:03, 773.99it/s]Processing spectra:  89%|████████▉ | 21005/23481 [00:13<00:03, 760.14it/s]Processing spectra:  90%|████████▉ | 21084/23481 [00:13<00:03, 680.76it/s]Processing spectra:  90%|█████████ | 21155/23481 [00:13<00:03, 646.57it/s]Processing spectra:  90%|█████████ | 21222/23481 [00:13<00:03, 618.87it/s]Processing spectra:  91%|█████████ | 21302/23481 [00:13<00:03, 661.82it/s]Processing spectra:  91%|█████████ | 21370/23481 [00:14<00:03, 651.27it/s]Processing spectra:  91%|█████████▏| 21448/23481 [00:14<00:02, 678.90it/s]Processing spectra:  92%|█████████▏| 21519/23481 [00:14<00:02, 684.59it/s]Processing spectra:  92%|█████████▏| 21611/23481 [00:14<00:02, 750.46it/s]Processing spectra:  93%|█████████▎| 21733/23481 [00:14<00:01, 882.03it/s]Processing spectra:  93%|█████████▎| 21915/23481 [00:14<00:01, 1152.87it/s]Processing spectra:  94%|█████████▍| 22044/23481 [00:14<00:01, 1129.03it/s]Processing spectra:  94%|█████████▍| 22159/23481 [00:14<00:01, 798.82it/s] Processing spectra:  95%|█████████▍| 22290/23481 [00:15<00:01, 910.25it/s]Processing spectra:  96%|█████████▌| 22489/23481 [00:15<00:00, 1168.94it/s]Processing spectra:  96%|█████████▋| 22622/23481 [00:15<00:00, 1055.70it/s]Processing spectra:  97%|█████████▋| 22741/23481 [00:15<00:00, 977.78it/s] Processing spectra:  97%|█████████▋| 22849/23481 [00:15<00:00, 884.76it/s]Processing spectra:  98%|█████████▊| 23022/23481 [00:15<00:00, 1078.67it/s]Processing spectra:  99%|█████████▉| 23332/23481 [00:15<00:00, 1577.95it/s]Processing spectra: 100%|██████████| 23481/23481 [00:15<00:00, 1481.21it/s]
/root/.cache/pypoetry/virtualenvs/spec2smiles-pipeline-XhsybQeG-py3.10/lib/python3.10/site-packages/torch/nn/modules/transformer.py:392: UserWarning: enable_nested_tensor is True, but self.use_nested_tensor is False because encoder_layer.norm_first was True
  warnings.warn(
Valid samples after processing: 23424

Data split:
  Train: 18739 samples
  Val:   2342 samples
  Test:  2343 samples

Training Hybrid CNN-Transformer model...
Training Part A with Hybrid CNN-Transformer model
HybridCNNTransformer initialized with 1,147,263 parameters
  - CNN hidden: 128, Transformer dim: 128
  - Heads: 4, Layers: 2
  - Device: cuda
