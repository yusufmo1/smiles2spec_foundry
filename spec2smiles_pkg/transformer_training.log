============================================================
TRAINING SPECTRUM TRANSFORMER: Spectrum -> Descriptors
============================================================
Loading data from ../spec2smiles/data/processed/hpj...
  Train: 2176 samples
  Val: 272 samples
  Spectrum bins: 500
  Descriptors: 12

Transformer configuration:
  d_model: 512
  n_heads: 8
  n_layers: 8
  d_ff: 2048
  patch_size: 10
  dropout: 0.1
  learning_rate: 0.0001
  batch_size: 64
  max_epochs: 300
  patience: 50
  device: cuda
SpectrumTransformer initialized with 33,104,908 parameters
  - Model dim: 512
  - Heads: 8
  - Layers: 8
  - Patch size: 10
  - Device: cuda

Training for up to 300 epochs...
  - Train samples: 2176
  - Val samples: 272
  - Batch size: 64
  - Early stopping patience: 50
Epoch   1 | Train Loss: 1.0602 | Val Loss: 0.9809 | Val R²: -0.0030 *
Epoch   6 | Train Loss: 1.0040 | Val Loss: 0.9834 | Val R²: -0.0062
Epoch  10 | Train Loss: 0.9903 | Val Loss: 0.8793 | Val R²: 0.0960 *
Epoch  11 | Train Loss: 0.9419 | Val Loss: 0.8410 | Val R²: 0.1334 *
Epoch  14 | Train Loss: 0.9108 | Val Loss: 0.8190 | Val R²: 0.1568 *
Epoch  15 | Train Loss: 0.8618 | Val Loss: 0.7857 | Val R²: 0.1897 *
Epoch  16 | Train Loss: 0.8713 | Val Loss: 0.7515 | Val R²: 0.2234 *
Epoch  18 | Train Loss: 0.8054 | Val Loss: 0.7434 | Val R²: 0.2338 *
Epoch  19 | Train Loss: 0.7829 | Val Loss: 0.7243 | Val R²: 0.2530 *
Epoch  21 | Train Loss: 0.7600 | Val Loss: 0.7405 | Val R²: 0.2347
Epoch  22 | Train Loss: 0.7660 | Val Loss: 0.7218 | Val R²: 0.2563 *
Epoch  24 | Train Loss: 0.7286 | Val Loss: 0.6913 | Val R²: 0.2862 *
Epoch  26 | Train Loss: 0.6927 | Val Loss: 0.6392 | Val R²: 0.3391 *
Epoch  29 | Train Loss: 0.6658 | Val Loss: 0.5855 | Val R²: 0.3945 *
Epoch  31 | Train Loss: 0.6783 | Val Loss: 0.5883 | Val R²: 0.3921
Epoch  32 | Train Loss: 0.6437 | Val Loss: 0.5764 | Val R²: 0.4054 *
Epoch  34 | Train Loss: 0.6387 | Val Loss: 0.5581 | Val R²: 0.4236 *
Epoch  36 | Train Loss: 0.6205 | Val Loss: 0.5441 | Val R²: 0.4364 *
Epoch  38 | Train Loss: 0.5955 | Val Loss: 0.5355 | Val R²: 0.4473 *
Epoch  41 | Train Loss: 0.5934 | Val Loss: 0.5243 | Val R²: 0.4573 *
Epoch  43 | Train Loss: 0.5608 | Val Loss: 0.5048 | Val R²: 0.4787 *
Epoch  46 | Train Loss: 0.5716 | Val Loss: 0.5243 | Val R²: 0.4581
Epoch  47 | Train Loss: 0.5432 | Val Loss: 0.4950 | Val R²: 0.4883 *
Epoch  50 | Train Loss: 0.5182 | Val Loss: 0.4800 | Val R²: 0.5039 *
Epoch  51 | Train Loss: 0.4937 | Val Loss: 0.5192 | Val R²: 0.4655
Epoch  53 | Train Loss: 0.4957 | Val Loss: 0.4795 | Val R²: 0.5048 *
Epoch  55 | Train Loss: 0.4828 | Val Loss: 0.4341 | Val R²: 0.5498 *
Epoch  56 | Train Loss: 0.4776 | Val Loss: 0.4812 | Val R²: 0.5028
Epoch  61 | Train Loss: 0.4384 | Val Loss: 0.4499 | Val R²: 0.5341
Epoch  63 | Train Loss: 0.4267 | Val Loss: 0.4327 | Val R²: 0.5517 *
Epoch  66 | Train Loss: 0.3991 | Val Loss: 0.4328 | Val R²: 0.5503
Epoch  67 | Train Loss: 0.3917 | Val Loss: 0.4289 | Val R²: 0.5549 *
Epoch  69 | Train Loss: 0.3878 | Val Loss: 0.4248 | Val R²: 0.5603 *
Epoch  71 | Train Loss: 0.3761 | Val Loss: 0.4745 | Val R²: 0.5099
Epoch  72 | Train Loss: 0.3708 | Val Loss: 0.4048 | Val R²: 0.5792 *
Epoch  76 | Train Loss: 0.3577 | Val Loss: 0.4651 | Val R²: 0.5192
Epoch  79 | Train Loss: 0.3152 | Val Loss: 0.3948 | Val R²: 0.5889 *
Epoch  80 | Train Loss: 0.3195 | Val Loss: 0.3921 | Val R²: 0.5927 *
Epoch  81 | Train Loss: 0.3072 | Val Loss: 0.4377 | Val R²: 0.5470
Epoch  82 | Train Loss: 0.3025 | Val Loss: 0.3786 | Val R²: 0.6080 *
Epoch  86 | Train Loss: 0.2792 | Val Loss: 0.4040 | Val R²: 0.5818
Epoch  91 | Train Loss: 0.2436 | Val Loss: 0.3936 | Val R²: 0.5896
Epoch  96 | Train Loss: 0.2178 | Val Loss: 0.3938 | Val R²: 0.5893
Epoch 101 | Train Loss: 0.2039 | Val Loss: 0.4002 | Val R²: 0.5855
Epoch 106 | Train Loss: 0.1781 | Val Loss: 0.3984 | Val R²: 0.5849
Epoch 111 | Train Loss: 0.1574 | Val Loss: 0.4071 | Val R²: 0.5768
Epoch 116 | Train Loss: 0.1382 | Val Loss: 0.4110 | Val R²: 0.5730
Epoch 121 | Train Loss: 0.1257 | Val Loss: 0.4008 | Val R²: 0.5820
Epoch 126 | Train Loss: 0.1106 | Val Loss: 0.3871 | Val R²: 0.5955
Epoch 131 | Train Loss: 0.0975 | Val Loss: 0.4237 | Val R²: 0.5589

Early stopping at epoch 132

============================================================
FINAL EVALUATION (Best Model)
============================================================

Overall Val R²: 0.6080
Overall Val Loss: 0.3786

Per-descriptor R²:
  MolWt               : 0.8424
  HeavyAtomCount      : 0.8534
  NumHeteroatoms      : 0.4874
  NumAromaticRings    : 0.8198
  RingCount           : 0.7094
  NOCount             : 0.4554
  NumHDonors          : 0.2092
  NumHAcceptors       : 0.4360
  TPSA                : 0.3663
  MolLogP             : 0.7332
  NumRotatableBonds   : 0.6525
  FractionCSP3        : 0.7308

Transformer training complete!
Best validation R²: 0.6080
Model saved to: models_gpu/transformer
